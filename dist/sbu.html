<html ng-app="myApp"> <head> <meta name="viewport" content="width=300px">. <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script> <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.7/angular.min.js"></script> <style>html, body, #map-canvas { height: 100%; margin: 0; padding: 0;}

body {overflow:hidden;}


.hide{
	display:none !important;
}

.nickname{
	text-align:center;
	color:rgba(200,200,200,1);
	padding-top:10vh;
	display:block;	
	position:absolute;
	top:0;
	bottom:0;
	left:0;
	right:0;
	z-index:10;
	background-color: rgba(5, 5, 5, .9);
}

.setnickname{
	border-width:3px;
	border-color:black;
	border-style:solid;
	margin-left: 40%;
	margin-right: 40%;
	background-color: rgba(50,50,50,1);
}

.header{
	position:absolute;
	height:10vh;
	width:100vw;
	top:0px;
	left:0px;
	right:0px;
	background-color: rgba(225, 225, 225, .8);
	z-index:2;
	overflow:hidden;
}

.logo{
	background-image: url(images/somewherebetween.67a70fc7.png);
	background-repeat: no-repeat;
	background-size: 100%;
	background-position: 50%;
	position: absolute;
	top: 0vh;
	left: 7vw;
	height: 10vh;
	width: 30vw;
	min-width: 8vh;
	max-width: 12vh;
}

.search_icon{
	background-image: url(images/search.png);
	background-repeat: no-repeat;
	background-size: 60%;
	background-position: 50%;
	position: absolute;
	top: 0px;
	right: 0px;
	height: 10vh;
	width: 10vw;
	min-width: 8vh;
	max-width: 12vh;
}

.friend_address{
	width:100%;
}

.friend_address_div{
	position:absolute;
	top:10vh;
	left:30vw;
	right:30vw; 
}

.send_invitation_button{
	position:relative;
	width:100px;
	top:20vh;
	margin:0 auto;
	background-color:grey;
	border-style:solid;
	border-width:3px;
	border-color:555555;
}


.leave_group{
	position:relative;
	margin-left:auto;
	margin-right:auto;
}

.leave_group_button{
	position:relative;
	width:100px;
	top:30vh;
	margin:0 auto;
	background-color:grey;
	border-style:solid;
	border-width:3px;
	border-color:555555;
}


.main{
	position:absolute;
	top:10vh;
	left:0px;
	right:0px;
	bottom:0vh;
	background-color:blue;
}

.footer{
	position:absolute;
	top:90vh;
	left:0px;
	right:0px;
	height:90vh;
	background-color:green;
	z-index:1;
}

.display_form{
	height:90vh !important;
	-webkit-transition:height 1s, -webkit-transform 2s;
	transition:height 1s, transform 2s;
}

.invite_form, .chat_form, .search_form{
	-webkit-transition:height 1s, -webkit-transform 2s;
	transition:height 1s, transform 2s;

}

.chat_icon, .invite_icon, .search_icon{
	width:10vw;
	height:10vh;
	position:absolute;
	top:0vh;
	background-repeat: no-repeat;
	background-size: 60%;
	background-position: 50%;
	min-width: 8vh;
	max-width: 12vh;
}

.chat_icon{
	background-image: url(images/chat_icon.61b2ecd2.png);
	left:32vw;
}

.invite_icon{
	background-image: url(images/add_user_icon.a0651b3c.png);
	left:57vw;
}

.search_icon{
	background-image: url(images/search_icon.de3631f7.png);
	left:84vw;
}</style> <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">  <body> <div class="nickname hide"> let's get started by creating a nickname<br><br> <input type="text" placeholder="nickname" class="nicknameval"><br><br> <i>(hint: use a nickname your friends would <br> recognize, such as FLastname or FirstnameL)</i><br><br> <div class="setnickname">let's go somewhere!</div> </div> <div class="header"> <div class="logo"></div> <div class="chat_icon"></div> <div class="invite_icon"></div> <div class="search_icon"></div> </div> <div class="main"> <div id="map-canvas"></div> </div> <style>.venue{
	width:100%;
}

.search_form{
	text-align:center;
	width:100vw;
	overflow:hidden;
	bottom:0px;
	height:0vh;
	position:absolute;
	background-color:rgba(225,225,225,0.9);
}

.search_headline{
	position:absolute;
	top:3vh;
	width:100vw;
}

.venue_type_div{
	position:absolute;
	top:10vh;
	left:30vw;
	right:30vw;
}

.search_button{
	position:absolute;
	top:20vh;
	left:30vw;
	right:30vw; 
	background-color:grey;
	border-style:solid;
	border-width:3px;
	border-color:555555;
}

.venue_type_div{
	position:absolute;
	top:12vh;
	left:30vw;
	right:30vw; 
}</style> <div class="search_form"> <div class="search_headline" style="text-align:center">what are you looking for?</div> <div class="venue_type_div"><input id="search_type" class="venue" type="text" placeholder="(i.e. coffee)"></div> <div class="search_button">search!</div> </div>  <style>.chat_form{
	text-align:center;
	width:100vw;
	overflow:hidden;
	bottom:0px;
	height:0vh;
	position:absolute;
	background-color:rgba(225,225,225,0.9);
}

.dialogue{
	margin:2vw;
	text-align:left;
}

.message_input{
	position:absolute;
	bottom:5px;
	left: 25vw;
	right: 156vw;
	width: 50vw;
}</style> <div class="chat_form"> <div class="dialogue" style="text-align:left"> <div id="dialogue_div" name="dialogue_div" style="height:80vh;width:96vw;overflow:auto"> </div> </div> <div class="message_input"><input class="comment_text" type="text"><input class="post_comment" type="button" value="post"></div> </div> <style>.invite_form{
	text-align:center;
	width:100vw;
	overflow:hidden;
	bottom:0px;
	height:0vh;
	position:absolute;
	background-color:rgba(225,225,225,0.9);
}</style> <div class="invite_form" ng-controller="MyController"> <div style="text-align:center">invite others!</div> <div class="friend_address_div"> <input class="friend_address" type="text" placeholder="(sms number or e-mail address)" value="{{ person.name }}"> </div> <div class="send_invitation_button">send invitation </div> <div class="leave_group leave_group_button">leave group</div> </div>   <footer> <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDK-5ej0LAqfkqLPoHf4nh9bG1lUXfKx6M"></script> <script src="bower_components/jquery.cookie/jquery.cookie.js"></script> <script type="text/javascript">var map = null;

	function centerMap(position) 
	{	
		var mapOptions = {
          center: { lat: position.coords.latitude, lng: position.coords.longitude},
          zoom: 9,
          disableDefaultUI: true
        };
        map = new google.maps.Map(document.getElementById('map-canvas'),
            mapOptions);

	}
	
	function nolocation(){
		alert('no location!');
	}

	function initialize() {
		if (navigator.geolocation) {
			navigator.geolocation.getCurrentPosition(centerMap,nolocation);
		} else {
			alert("Geolocation is not supported by this browser.");
		}

    }

	google.maps.event.addDomListener(window, 'load', initialize);</script> <script>$(".search_icon").on("click",function(){
		$(".chat_form").removeClass("display_form");
		$(".invite_form").removeClass("display_form");
		$(".search_form").toggleClass("display_form");
		$(".venue").focus();
		
	});

	$(".invite_icon").on("click",function(){
		$(".chat_form").removeClass("display_form");
		$(".search_form").removeClass("display_form");
		$(".invite_form").toggleClass("display_form");
	});

	$(".chat_icon").on("click",function(){
		$(".invite_form").removeClass("display_form");
		$(".search_form").removeClass("display_form");
		$(".chat_form").toggleClass("display_form");
	});</script> <script>var app = angular.module('myApp', []);

app.run(function($rootScope){
//	$rootScope.name = "Rob";
});

app.controller('MyController',['$scope','$http',function($scope, $http){
	$scope.sendInvitation = function(){
		var name = $scope.person.name;
		$http({
		  //data:{name:name},
		  method: 'JSONP',
  		  url: 'https://api.github.com/events?callback=JSON_CALLBACK'
		}).success(function(data, status, headers, config) {
			alert('good');
		  // data contains the response
		  // status is the HTTP status
		  // headers is the header getter function
		  // config is the object that was used to create the HTTP request
		}).error(function(data, status, headers, config) {
			alert('bad');
		});
	};

	$scope.verifyCorsEnabled = function(){
		$http({
			method:'POST',
			url:'http://somewherebetweenus-server.herokuapp.com/User/useHelloWorldService',
			data:{"foo":"bar"},
			headers: {
                    'Content-Type': 'application/json; charset=utf-8'
        	}
		}).success(function(data) {
			alert(data.name);
		  // data contains the response{}
		  // status is the HTTP status
		  // headers is the header getter function
		  // config is the object that was used to create the HTTP request
		}).error(function(data, status) {
			alert(status);
		});
	};
	//$scope.person={
	//	name:'Robby'
	//};
}]);</script> <script type="text/javascript">$(document).ready(function(){

	var GetQueryStringParams = function(sParam){
	    var sPageURL = window.location.search.substring(1);
	    var sURLVariables = sPageURL.split('&');
	    for (var i = 0; i < sURLVariables.length; i++) 
	    {
	        var sParameterName = sURLVariables[i].split('=');
	        if (sParameterName[0] == sParam) 
	        {
	            return sParameterName[1];
	        }
	    }
	}


	var guestID = $.cookie("guestID");
	if(guestID == null) 
	{
		//make a guest id for this session
		var guestID = Math.random().toString(36);
		$.cookie("guestID", guestID, { expires : 10 });
	}


	var meetingID = $.cookie("meetingID");
	if(meetingID != null) //it's already set...bail out
		return; 


	//was the meetingID set in the query parameter?
	var meetingID = GetQueryStringParams('meetingID');
	if(meetingID != null)
	{
		$.cookie("meetingID", meetingID, { expires : 10 });
		return;
	}

	//ok...so it's not set in a cookie and wasn't passed in...so create it
	var meetingID = Math.random().toString(36);
	$.cookie("meetingID", meetingID, { expires : 10 });
	//create a user id as well

	

});</script> <script type="text/javascript">$(document).ready(function(){
		var nickname = $.cookie("nickname",nickname,{expires:10});
		if(nickname == null)
			$(".nickname").removeClass("hide");

});</script> <script type="text/javascript">$(".setnickname").on("click",function(){

		if (navigator.geolocation) {
			navigator.geolocation.getCurrentPosition(registerGuest,nolocation);
		} else {
			alert("Geolocation is not supported by this browser.");
		}
	});

	var registerGuest = function(position)
	{
        //set nickname
		var nickname = $(".nicknameval").val();
		$.cookie("nickname",nickname,{expires:10});

		var meetingID = $.cookie("meetingID");
		var guestID = $.cookie("guestID");
		var latitude = position.coords.latitude;
		var longitude = position.coords.longitude;

		$.ajax({
		  type: "POST",
		  url: "http://somewherebetweenus-server.herokuapp.com/Meeting/create",
		  data: {"nickname":nickname,
			"meetingID":meetingID,
			"guestID":guestID,
			"latitude":latitude,
			"longitude":longitude},
		  success: function(data){
		  	$(".nickname").addClass("hide");
		  	console.log('all good');
		  },
		  fail:function(){
		  	console.log('nope');

		  }
		});
	};

	$(".send_invitation_button").on("click",function(){
		//set nickname
		var nickname = $.cookie("nickname");
		var sms_number = $(".friend_address").val();
		var meetingID = $.cookie("meetingID");

		$.ajax({
		  type: "POST",
		  url: "http://somewherebetweenus-server.herokuapp.com/Meeting/inviteGuest",
		  data: {"nickname":nickname,
			"meetingID":meetingID,
			"smsNumber":sms_number},
		  success: function(data){
		  	$(".nickname").addClass("hide");
		  	console.log('all good');
		  },
		  fail:function(){
		  	console.log('nope');

		  }
		});
	});

	$(".leave_group_button").on("click",function(){
		//set nickname
		$.removeCookie("nickname");
		$.removeCookie('meetingID');
		$.removeCookie('guestID');

		location.reload();

	});</script> <script type="text/javascript">var mapmarkers = [];
	var venueMarkers = [];
	var searchinfowindows = [];
	var guestinfowindows = [];
	var venueinfowindows = [];
	var venues = [];

	$(".search_button").on("click",function(){
		$(".search_form").removeClass("display_form");
		search_venues();
	});

	var updateMapMarkers = function(){

		if(map == null)
			return;

		var meetingID = $.cookie("meetingID");

		$.ajax({
		  type: "POST",
		  url: "http://somewherebetweenus-server.herokuapp.com/Meeting/getmeetingmarkers",
		  data: {"meetingID":meetingID},
		  success: function(data){
		  	data = JSON.parse(data);
		  	displayMapMarkers(data)
		  	console.log('all good');
		  },
		  fail:function(){
		  	console.log('nope');
		  }
		});
	};

	var displayMapMarkers = function(markers){

		clearMapMarkers();

	    for (var i = 0; i < markers.length; i++) 
	    {
	    	if(markers[i].type == 'guest')
	    	{

			  	var myLatlng = new google.maps.LatLng(markers[i].latitude,markers[i].longitude);

			  	var marker = new google.maps.Marker({
			      	position: myLatlng,
			      	map: map,
			    	title:markers[i].nickname
			  	});

			  	if(markers[i].nickname == $.cookie("nickname"))
				  	marker.setIcon('http://maps.google.com/mapfiles/ms/icons/blue-dot.png');
				else
				 	marker.setIcon('http://maps.google.com/mapfiles/ms/icons/green-dot.png');


				mapmarkers[mapmarkers.length] = marker;

			 	var html = '<div style="width:150px"><span style="font-weight:bold" class="venue_name">' + markers[i].nickname + '</span><br></div>';

				var infowindow = new google.maps.InfoWindow();
	            makeInfoWindowEvent(map, infowindow,guestinfowindows, html, marker);

	    	}
	    	if(markers[i].type == 'venue')
	    	{

	    		if(markers[i].voters == 0)
	    			continue;

			  	var myLatlng = new google.maps.LatLng(markers[i].latitude,markers[i].longitude);

			  	var marker = new google.maps.Marker({
			      	position: myLatlng,
			      	map: map,
			    	title: markers[i].name
			  	});

			  	marker.setIcon('http://maps.google.com/mapfiles/ms/icons/orange-dot.png');


       			mapmarkers[mapmarkers.length] = marker;

			 	var html = '<div style="width:150px"><span style="font-weight:bold" class="venue_name">' + markers[i].name + '</span><br>';
			 	html = html + '<span>Votes:'+markers[i].voters+'</span></div>';
			 	html = html + '<span class="vote_link" ><a href=\'javascript:addVoter('+markers[i].venueID+');\'> Vote!</a></span></div>';

				var infowindow = new google.maps.InfoWindow();
	            makeInfoWindowEvent(map, infowindow,venueinfowindows, html, marker);
	    	}
	    }


		for (var i = 0; i < mapmarkers.length; i++) 
			mapmarkers[i].setMap(map);
	}



	var search_venues = function()
	{

		var meetingID = $.cookie("meetingID");
		var venueType = $(".venue").val();
		var _data = {
				"meetingID":meetingID,
				"venueType":venueType
			};

		$.ajax({
			type: "POST",
			url: "http://somewherebetweenus-server.herokuapp.com/Yelp/findVenues",
			data:_data,
			success: function(data){
				var venues = JSON.parse(data);
				displaySearchResults(venues)
			},
			fail:function(){
			  	console.log('nope');

			}
		});
	}

	var displaySearchResults = function(_venues){

		clearSearchResults();
		venues = [];

	    for (var i = 0; i < _venues.length; i++) 
	    {
			 	var venue = _venues[i];

			  	var myLatlng = new google.maps.LatLng(_venues[i].coordinates.latitude,_venues[i].coordinates.longitude);

			  	var marker = new google.maps.Marker({
			      	position: myLatlng,
			      	map: map,
			    	title: venue.name,
				      icon: new google.maps.MarkerImage(
				        "http://chart.googleapis.com/chart?chst=d_bubble_text_small&chld=bb|"+venue.name+"|FF8080|000000",
				        null, null, new google.maps.Point(0, 42)),
				      shadow: new google.maps.MarkerImage(
				        "http://chart.googleapis.com/chart?chst=d_bubble_text_small_shadow&chld=bb|"+venue.name,
				        null, null, new google.maps.Point(0, 45))
			  	});




			 	marker.setIcon('http://maps.google.com/mapfiles/ms/icons/yellow-dot.png');

			 	venues[venue.id] = venue;

			 	var html = '<div style="width:150px"><span style="font-weight:bold" class="venue_name">' + venue.name + '</span><br>';
			 	html = html + '<span class="vote_link" ><a href=\'javascript:vote('+venue.id+');\'> Vote!</a></span></div>';


				var infowindow = new google.maps.InfoWindow();
                makeInfoWindowEvent(map, infowindow,searchinfowindows, html, marker);
			  	venueMarkers[venueMarkers.length] = marker;
	    	}

		for (var i = 0; i < venueMarkers.length; i++) 
			venueMarkers[i].setMap(map);
	}

	var clearSearchResults = function()
	{
		for (var i = 0; i < venueMarkers.length; i++) 
			venueMarkers[i].setMap(null);

		venueMarkers = [];

	}

	var clearMapMarkers = function()
	{
		for (var i = 0; i < mapmarkers.length; i++) 
			mapmarkers[i].setMap(null);

		mapmarkers = [];
	}


    var makeInfoWindowEvent = function(map, infowindow, infoWindowsArray,contentString, marker) 
    {
        infoWindowsArray.push(infowindow);

        google.maps.event.addListener(marker, 'click', function() {
            for(var i=0; i<infoWindowsArray.length; i++)
                infoWindowsArray[i].close();
            infowindow.setContent(contentString);
            infowindow.open(map, marker);
        });
    }

	//start update loop
	setTimeout(function(){updateMapMarkers();},3000);
	setInterval(function(){updateMapMarkers();},60000);

	var vote = function(id)
	{
		$("body").focus();//take focus off input
		venue = venues[id];
		addVenue(venue.id,venue.name,venue.coordinates.latitude,venue.coordinates.longitude);
		//bust default anchor action
		return false;
	}

	var addVenue = function(venueID,businessname,latitude,longitude)
	{
		var _data = {
			venueID: venueID,
			meetingID: $.cookie("meetingID"),
			businessname: businessname,
			yelpID: 0,
			latitude: latitude,
			longitude: longitude
		};

		$.ajax({
			type: "POST",
			url: "http://somewherebetweenus-server.herokuapp.com/Venue/addvenue",
			data:_data,
			success: function(data){
				addVoter(venueID);
			},
			fail:function(){
			  	console.log('nope');

			}
		});
	}

	var addVoter = function(venueID)
	{
		var _meetingID = $.cookie("meetingID");
		var _guestID = $.cookie("guestID");

		var _data = {
			venueID: venueID,
			meetingID: _meetingID,
			guestID:_guestID
		}

		$.ajax({
			type: "POST",
			url: "http://somewherebetweenus-server.herokuapp.com/Venue/addvoter",
			data:_data,
			success: function(data){
				console.log('all good');
				clearSearchResults();
				updateMapMarkers();
			},
			fail:function(){
			  	console.log('nope');
			  	clearSearchResults();

			}
		});
	}</script> <script>//scripts for chat

setInterval(function(){refreshChat();},5000);

$(".post_comment").on("click",function(){postChat();});

function postChat()
{

	var comment = $(".comment_text").val();
	var _data = {"guestID":$.cookie("guestID"),
			"meetingID":$.cookie("meetingID"),
			"comment":comment};

	$.ajax({
		type: "POST",
		url: "http://somewherebetweenus-server.herokuapp.com/Meeting/addcomment",
		data:_data,
		success: function(data){
			console.log('all good');
		},
		fail:function(){
		  	console.log('nope');

		}
	});
}

function refreshChat()
{

	if($(".chat_form").hasClass("display_form") == false)
		return;

	var meetingID = $.cookie("meetingID");

	if(meetingID == null)
		return;

	$.ajax({
		type: "POST",
		url: "http://somewherebetweenus-server.herokuapp.com/Meeting/getcomments",
		data: {"meetingID":meetingID},
		success: function(data){
			var comments = JSON.parse(data);
			var output = "";
			for(var i=0; i<comments.length; i++)
				output = output + comments[i].comment+"<br>";

		  	$("#dialogue_div").html(output);
		  	$("#dialogue_div").scrollTop($("#dialogue_div")[0].scrollHeight);
		  	console.log('all good');
		},
		fail:function(){
		  	console.log('nope');

		}
	});

}</script> <script>//search</script> </footer> 