<html ng-app="myApp">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">.
<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.7/angular.min.js"></script>

<style>

html, body, #map-canvas { height: 100%; margin: 0; padding: 0;}


.hide{
	display:none !important;
}

.nickname{
	text-align:center;
	color:rgba(200,200,200,1);
	padding-top:10vh;
	display:block;	
	position:absolute;
	top:0;
	bottom:0;
	left:0;
	right:0;
	z-index:10;
	background-color: rgba(5, 5, 5, .9);
}

.setnickname{
	border-width:3px;
	border-color:black;
	border-style:solid;
	margin-left: 40%;
	margin-right: 40%;
	background-color: rgba(50,50,50,1);
}

.header{
	position:absolute;
	height:10vh;
	width:100vw;
	top:0px;
	left:0px;
	right:0px;
	background-color: rgba(225, 225, 225, .8);
	z-index:2;
	overflow:hidden;
}

.header_expanded{
	height:90vh !important;
}

.logo{
	background-image: url(images/somewherebetween.png);
	background-repeat: no-repeat;
	background-size: 100%;
	background-position: 50%;
	position: absolute;
	top: 0px;
	left: 0px;
	height: 10vh;
	width: 30vw;
	min-width: 8vh;
	max-width: 12vh;
}

.menu_icon{
	background-image: url(images/menu-icon.png);
	background-repeat: no-repeat;
	background-size: 60%;
	background-position: 50%;
	position: absolute;
	top: 0px;
	right: 0px;
	height: 10vh;
	width: 10vw;
	min-width: 8vh;
	max-width: 12vh;
}

.invite_form{
	text-align:center;
	position:relative;
	top:10vh;
	height:80vh;
	margin-left:auto;
	margin-right:auto;
	width:300px;
}

.friend_address{
	width:100%;
}

.friend_address_div{
	position:absolute;
	top:10%;
	left:10%;
	right:10%; 
}

.send_invitation_button{
	position:absolute;
	top:20%;
	left:10%;
	right:10%; 
	background-color:grey;
	border-style:solid;
	border-width:3px;
	border-color:555555;
}


.leave_group{
	position:relative;
	margin-left:auto;
	margin-right:auto;
}

.leave_group_button{
	position:absolute;
	top:30%;
	left:10%;
	right:10%; 
	background-color:grey;
	border-style:solid;
	border-width:3px;
	border-color:555555;
}


.main{
	position:absolute;
	top:10vh;
	left:0px;
	right:0px;
	bottom:10vh;
	background-color:blue;
}

.footer{
	position:absolute;
	bottom:0px;
	left:0px;
	right:0px;
	height:10vh;
	background-color:green;
	z-index:1;
}

.footer_expanded{
	height:90vh !important;
}

</style>

<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

</head>
<body>

<div class="nickname hide">
	let's get started by creating a nickname<br><br>
	<input type="text" placeholder="nickname" class="nicknameval"/><br><br>
	<i>(hint: use a nickname your friends would <br>
		recognize, such as FLastname or FirstnameL)</i><br><br>
	<div class="setnickname">let's go somewhere!</div>
</div>

<div class="header">
	<div class="logo"></div>
	<div class="menu_icon"></div>
	<div class="invite_form" ng-controller="MyController">
		<div style="text-align:center">invite others!</div>
		<div class="friend_address_div"><input class="friend_address" type="text" placeholder="(sms number or e-mail address)" value="{{ person.name }}"/></div>
		<div class="send_invitation_button">send invitation </div>
		<div class="leave_group leave_group_button">leave group</div>
		</div>
	</div>

</div>

<div class="main">
<div id="map-canvas"></div>
</div>

<div class="footer">
</div>


</body>
<footer>


<script type="text/javascript"
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDK-5ej0LAqfkqLPoHf4nh9bG1lUXfKx6M">
</script>
<script src="bower_components/jquery.cookie/jquery.cookie.js"></script>
<script type="text/javascript">
	var map = null;

	function centerMap(position) 
	{	
		var mapOptions = {
          center: { lat: position.coords.latitude, lng: position.coords.longitude},
          zoom: 9,
          disableDefaultUI: true
        };
        map = new google.maps.Map(document.getElementById('map-canvas'),
            mapOptions);


	  var myLatlng = new google.maps.LatLng(position.coords.latitude,position.coords.longitude);

	  var marker = new google.maps.Marker({
	      position: myLatlng,
	      map: map,
	      title: 'Hello World!'
	  });
	}
	
	function nolocation(){
		alert('no location!');
	}

	function initialize() {
		if (navigator.geolocation) {
			navigator.geolocation.getCurrentPosition(centerMap,nolocation);
		} else {
			alert("Geolocation is not supported by this browser.");
		}

    }

	google.maps.event.addDomListener(window, 'load', initialize);
</script>

<script>


	$(".menu_icon").on("click",function(){
		$(".header").toggleClass("header_expanded");
	});

	$(".footer").on("click",function(){
		$(".footer").toggleClass("footer_expanded");
	});

	
</script>

<script>
<!-- angular stuff -->
var app = angular.module('myApp', []);

app.run(function($rootScope){
//	$rootScope.name = "Rob";
});

app.controller('MyController',['$scope','$http',function($scope, $http){
	$scope.sendInvitation = function(){
		var name = $scope.person.name;
		$http({
		  //data:{name:name},
		  method: 'JSONP',
  		  url: 'https://api.github.com/events?callback=JSON_CALLBACK'
		}).success(function(data, status, headers, config) {
			alert('good');
		  // data contains the response
		  // status is the HTTP status
		  // headers is the header getter function
		  // config is the object that was used to create the HTTP request
		}).error(function(data, status, headers, config) {
			alert('bad');
		});
	};

	$scope.verifyCorsEnabled = function(){
		$http({
			method:'POST',
			url:'http://somewherebetweenus-server.herokuapp.com/User/useHelloWorldService',
			data:{"foo":"bar"},
			headers: {
                    'Content-Type': 'application/json; charset=utf-8'
        	}
		}).success(function(data) {
			alert(data.name);
		  // data contains the response{}
		  // status is the HTTP status
		  // headers is the header getter function
		  // config is the object that was used to create the HTTP request
		}).error(function(data, status) {
			alert(status);
		});
	};
	//$scope.person={
	//	name:'Robby'
	//};
}]);


</script>


<script type="text/javascript">



$(document).ready(function(){

	var GetQueryStringParams = function(sParam){
	    var sPageURL = window.location.search.substring(1);
	    var sURLVariables = sPageURL.split('&');
	    for (var i = 0; i < sURLVariables.length; i++) 
	    {
	        var sParameterName = sURLVariables[i].split('=');
	        if (sParameterName[0] == sParam) 
	        {
	            return sParameterName[1];
	        }
	    }
	}


	var guestID = $.cookie("guestID");
	if(guestID == null) 
	{
		//make a guest id for this session
		var guestID = Math.random().toString(36);
		$.cookie("guestID", guestID, { expires : 10 });
	}


	var meetingID = $.cookie("meetingID");
	if(meetingID != null) //it's already set...bail out
		return; 


	//was the meetingID set in the query parameter?
	var meetingID = GetQueryStringParams('meetingID');
	if(meetingID != null)
	{
		$.cookie("meetingID", meetingID, { expires : 10 });
		return;
	}

	//ok...so it's not set in a cookie and wasn't passed in...so create it
	var meetingID = Math.random().toString(36);
	$.cookie("meetingID", meetingID, { expires : 10 });
	//create a user id as well

	

});
</script>

<script type="text/javascript">

$(document).ready(function(){
		var nickname = $.cookie("nickname",nickname,{expires:10});
		if(nickname == null)
			$(".nickname").removeClass("hide");

});
</script>

<script type="text/javascript">

	$(".setnickname").on("click",function(){
		//set nickname
		var nickname = $(".nicknameval").val();
		$.cookie("nickname",nickname,{expires:10});

		var meetingID = $.cookie("meetingID");
		var guestID = $.cookie("guestID");

		$.ajax({
		  type: "POST",
		  url: "http://somewherebetweenus-server.herokuapp.com/Meeting/create",
		  data: {"nickname":nickname,
			"meetingid":meetingID,
			"guestid":guestID},
		  success: function(data){
		  	$(".nickname").addClass("hide");
		  	console.log('all good');
		  },
		  fail:function(){
		  	console.log('nope');

		  }
		});
	});

	$(".send_invitation_button").on("click",function(){
		//set nickname
		var nickname = $.cookie("nickname");
		var sms_number = $(".friend_address").val();
		var meetingID = $.cookie("meetingID");

		$.ajax({
		  type: "POST",
		  url: "http://somewherebetweenus-server.herokuapp.com/Meeting/inviteGuest",
		  data: {"nickname":nickname,
			"meetingID":meetingID,
			"smsNumber":sms_number},
		  success: function(data){
		  	$(".nickname").addClass("hide");
		  	console.log('all good');
		  },
		  fail:function(){
		  	console.log('nope');

		  }
		});
	});

	$(".leave_group_button").on("click",function(){
		//set nickname
		$.removeCookie("nickname");
		$.removeCookie('meetingID');
		$.removeCookie('guestID');

		location.reload();

	});
</script>

</footer>
</html>